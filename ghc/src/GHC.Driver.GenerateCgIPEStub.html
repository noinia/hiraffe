<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.GenerateCgIPEStub</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier">generateCgIPEStub</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.html#/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.0.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/Data.Maybe.html#listToMaybe/Data.Maybe.html#listToMaybe"><span class="hs-identifier">listToMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier">CLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.html"><span class="hs-identifier">GHC.Cmm.Dataflow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier">C</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier">O</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier">blockSplit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier">blockToList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Collections.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Collections</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Collections.html#mapToList"><span class="hs-identifier">mapToList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Label</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier">Label</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html"><span class="hs-identifier">GHC.Cmm.Info.Build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier">emptySRT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Pipeline.html"><span class="hs-identifier">GHC.Cmm.Pipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier">cmmPipeline</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Maybe.html#firstJusts"><span class="hs-identifier">firstJusts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier">Stream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Stream</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier">hsc_dflags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier">hsc_logger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html"><span class="hs-identifier">GHC.Driver.Env.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html"><span class="hs-identifier">GHC.Driver.Flags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier">GeneralFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_InfoTableMap"><span class="hs-identifier">Opt_InfoTableMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier">gopt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier">targetPlatform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.StgToCmm.html"><span class="hs-identifier">GHC.Driver.Config.StgToCmm</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Cmm.html"><span class="hs-identifier">GHC.Driver.Config.Cmm</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#isStackRep"><span class="hs-identifier">isStackRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.html"><span class="hs-identifier">GHC.Settings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier">Platform</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Platform.html#platformTablesNextToCode"><span class="hs-identifier">platformTablesNextToCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html"><span class="hs-identifier">GHC.StgToCmm.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Monad.html#getCmm"><span class="hs-identifier">getCmm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#initC"><span class="hs-identifier">initC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#runC"><span class="hs-identifier">runC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#initFCodeState"><span class="hs-identifier">initFCodeState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html"><span class="hs-identifier">GHC.StgToCmm.Prof</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Prof.html#initInfoTableProv"><span class="hs-identifier">initInfoTableProv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier">CmmCgInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier">ModuleLFInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html"><span class="hs-identifier">GHC.Types.IPE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier">InfoTableProvMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.IPE.html#provInfoTables"><span class="hs-identifier">provInfoTables</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#NonCaffySet"><span class="hs-identifier">NonCaffySet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#GenTickish"><span class="hs-identifier">GenTickish</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier">SourceNote</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">{-
Note [Stacktraces from Info Table Provenance Entries (IPE based stack unwinding)]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Stacktraces can be created from return frames as they are pushed to stack for every case scrutinee.
But to make them readable / meaningful, one needs to know the source location of each return frame.

Every return frame has a distinct info table and thus a distinct code pointer (for tables next to
code) or at least a distinct address itself. Info Table Provenance Entries (IPEs) are searchable by
this pointer and contain a source location.

The info table / info table code pointer to source location map is described in:
Note [Mapping Info Tables to Source Positions]

To be able to lookup IPEs for return frames one needs to emit them during compile time. This is done
by `generateCgIPEStub`.

This leads to the question: How to figure out the source location of a return frame?

While the lookup algorithms when tables-next-to-code is on/off differ in details, they have in
common that we want to lookup the `CmmNode.CmmTick` (containing a `SourceNote`) that is nearest
(before) the usage of the return frame's label. (Which label and label type is used differs between
these two use cases.)

With tables-next-to-code
~~~~~~~~~~~~~~~~~~~~~~~~

Let's consider this example:
```
 Main.returnFrame_entry() { //  [R2]
         { info_tbls: [(c18g,
                        label: block_c18g_info
                        rep: StackRep []
                        srt: Just GHC.CString.unpackCString#_closure),
                       (c18r,
                        label: Main.returnFrame_info
                        rep: HeapRep static { Fun {arity: 1 fun_type: ArgSpec 5} }
                        srt: Nothing)]
           stack_info: arg_space: 8
         }
     {offset

      [...]

       c18u: // global
           //tick src&lt;Main.hs:(7,1)-(16,15)&gt;
           I64[Hp - 16] = sat_s16B_info;
           P64[Hp] = _s16r::P64;
           _c17j::P64 = Hp - 16;
           //tick src&lt;Main.hs:8:25-39&gt;
           I64[Sp - 8] = c18g;
           R3 = _c17j::P64;
           R2 = GHC.IO.Unsafe.unsafePerformIO_closure;
           R1 = GHC.Base.$_closure;
           Sp = Sp - 8;
           call stg_ap_pp_fast(R3,
                               R2,
                               R1) returns to c18g, args: 8, res: 8, upd: 8;
```

The return frame `block_c18g_info` has the label `c18g` which is used in the call to `stg_ap_pp_fast`
(`returns to c18g`) as continuation (`cml_cont`). The source location we're after, is the nearest
`//tick` before the call (`//tick src&lt;Main.hs:8:25-39&gt;`).

In code the Cmm program is represented as a Hoopl graph. Hoopl distinguishes nodes by defining if they
are open or closed on entry (one can fallthrough to them from the previous instruction) and if they are
open or closed on exit (one can fallthrough from them to the next node).

Please refer to the paper &quot;Hoopl: A Modular, Reusable Library for Dataflow Analysis and Transformation&quot;
for a detailed explanation.

Here we use the fact, that calls (represented by `CmmNode.CmmCall`) are always closed on exit
(`CmmNode O C`, `O` means open, `C` closed). In other words, they are always at the end of a block.

So, given a stack represented info table (likely representing a return frame, but this isn't completely
sure as there are e.g. update frames, too) with it's label (`c18g` in the example above) and a `CmmGraph`:
  - Look at the end of every block, if it's a `CmmNode.CmmCall` returning to the continuation with the
    label of the return frame.
  - If there's such a call, lookup the nearest `CmmNode.CmmTick` by traversing the middle part of the block
    backwards (from end to beginning).
  - Take the first `CmmNode.CmmTick` that contains a `Tickish.SourceNote` and return it's payload as
    `IpeSourceLocation`. (There are other `Tickish` constructors like `ProfNote` or `HpcTick`, these are
    ignored.)

Without tables-next-to-code
~~~~~~~~~~~~~~~~~~~~~~~~~~~

When tables-next-to-code is off, there is no return frame / continuation label in calls. The continuation (i.e. return
frame) is set in an explicit Cmm assignment. Thus the tick lookup algorithm has to be slightly different.

```
 sat_s16G_entry() { //  [R1]
         { info_tbls: [(c18O,
                        label: sat_s16G_info
                        rep: HeapRep { Thunk }
                        srt: Just _u18Z_srt)]
           stack_info: arg_space: 0
         }
     {offset
       c18O: // global
           _s16G::P64 = R1;
           if ((Sp + 8) - 40 &lt; SpLim) (likely: False) goto c18P; else goto c18Q;
       c18P: // global
           R1 = _s16G::P64;
           call (stg_gc_enter_1)(R1) args: 8, res: 0, upd: 8;
       c18Q: // global
           I64[Sp - 16] = stg_upd_frame_info;
           P64[Sp - 8] = _s16G::P64;
           //tick src&lt;Main.hs:20:9-13&gt;
           I64[Sp - 24] = block_c18M_info;
           R1 = GHC.Show.$fShow[]_closure;
           P64[Sp - 32] = GHC.Show.$fShowChar_closure;
           Sp = Sp - 32;
           call stg_ap_p_fast(R1) args: 16, res: 8, upd: 24;
     }
 },
 _blk_c18M() { //  [R1]
         { info_tbls: [(c18M,
                        label: block_c18M_info
                        rep: StackRep []
                        srt: Just System.IO.print_closure)]
           stack_info: arg_space: 0
         }
     {offset
       c18M: // global
           _s16F::P64 = R1;
           R1 = System.IO.print_closure;
           P64[Sp] = _s16F::P64;
           call stg_ap_p_fast(R1) args: 32, res: 0, upd: 24;
     }
 },
```

In this example we have to lookup `//tick src&lt;Main.hs:20:9-13&gt;` for the return frame `c18M`.
Notice, that this cannot be done with the `Label` `c18M`, but with the `CLabel` `block_c18M_info`
(`label: block_c18M_info` is actually a `CLabel`).

The find the tick:
  - Every `Block` is checked from top (first) to bottom (last) node for an assignment like
   `I64[Sp - 24] = block_c18M_info;`. The lefthand side is actually ignored.
  - If such an assignment is found the search is over, because the payload (content of
    `Tickish.SourceNote`, represented as `IpeSourceLocation`) of last visited tick is always
    remembered in a `Maybe`.
-}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier hs-type">generateCgIPEStub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Set.html#NonCaffySet"><span class="hs-identifier hs-type">NonCaffySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier hs-type">ModuleLFInfos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span>
</span><span id="line-182"></span><span id="generateCgIPEStub"><span class="annot"><span class="annottext">generateCgIPEStub :: HscEnv
-&gt; Module
-&gt; InfoTableProvMap
-&gt; Stream IO CmmGroupSRTs (NonCaffySet, ModuleLFInfos)
-&gt; Stream IO CmmGroupSRTs CmmCgInfos
</span><a href="GHC.Driver.GenerateCgIPEStub.html#generateCgIPEStub"><span class="hs-identifier hs-var hs-var">generateCgIPEStub</span></a></span></span><span> </span><span id="local-6989586621681893140"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681893140"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681893141"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681893141"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681893142"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681893142"><span class="hs-identifier hs-var">denv</span></a></span></span><span> </span><span id="local-6989586621681893143"><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs (NonCaffySet, ModuleLFInfos)
</span><a href="#local-6989586621681893143"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681893144"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681893144"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681893140"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span id="local-6989586621681893145"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681893145"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681893144"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span id="local-6989586621681893146"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621681893146"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681893140"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-186"></span><span>      </span><span id="local-6989586621681893147"><span class="annot"><span class="annottext">fstate :: FCodeState
</span><a href="#local-6989586621681893147"><span class="hs-identifier hs-var hs-var">fstate</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; FCodeState
</span><a href="GHC.StgToCmm.Monad.html#initFCodeState"><span class="hs-identifier hs-var">initFCodeState</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681893145"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-187"></span><span>      </span><span id="local-6989586621681893148"><span class="annot"><span class="annottext">cmm_cfg :: CmmConfig
</span><a href="#local-6989586621681893148"><span class="hs-identifier hs-var hs-var">cmm_cfg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; CmmConfig
</span><a href="GHC.Driver.Config.Cmm.html#initCmmConfig"><span class="hs-identifier hs-var">initCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681893144"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621681893150"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681893150"><span class="hs-identifier hs-var">cgState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CgState -&gt; Stream IO CmmGroupSRTs CgState
forall a. IO a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.0.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO CgState
</span><a href="GHC.StgToCmm.Monad.html#initC"><span class="hs-identifier hs-var">initC</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-comment">-- Collect info tables, but only if -finfo-table-map is enabled, otherwise labeledInfoTablesWithTickishes is empty.</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681893151"><span class="annot"><span class="annottext">collectFun :: [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; CmmGroupSRTs
-&gt; IO
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
</span><a href="#local-6989586621681893151"><span class="hs-identifier hs-var hs-var">collectFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_InfoTableMap"><span class="hs-identifier hs-var">Opt_InfoTableMap</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681893144"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; CmmGroupSRTs
-&gt; IO
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
</span><a href="#local-6989586621681893152"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681893145"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; CmmGroupSRTs
-&gt; IO
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
forall a. [a] -&gt; CmmGroupSRTs -&gt; IO ([a], CmmGroupSRTs)
</span><a href="#local-6989586621681893153"><span class="hs-identifier hs-var">collectNothing</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681893154"><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
</span><a href="#local-6989586621681893154"><span class="hs-identifier hs-var">labeledInfoTablesWithTickishes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681893155"><span class="annot"><span class="annottext">NonCaffySet
</span><a href="#local-6989586621681893155"><span class="hs-identifier hs-var">nonCaffySet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893156"><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681893156"><span class="hs-identifier hs-var">moduleLFInfos</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([(Label, CmmInfoTable, Maybe IpeSourceLocation)]
 -&gt; CmmGroupSRTs
 -&gt; IO
      ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs))
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; Stream IO CmmGroupSRTs (NonCaffySet, ModuleLFInfos)
-&gt; Stream
     IO
     CmmGroupSRTs
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)],
      (NonCaffySet, ModuleLFInfos))
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
(c -&gt; a -&gt; m (c, b)) -&gt; c -&gt; Stream m a r -&gt; Stream m b (c, r)
</span><a href="GHC.Data.Stream.html#mapAccumL_"><span class="hs-identifier hs-var">Stream.mapAccumL_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; CmmGroupSRTs
-&gt; IO
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
</span><a href="#local-6989586621681893151"><span class="hs-identifier hs-var">collectFun</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs (NonCaffySet, ModuleLFInfos)
</span><a href="#local-6989586621681893143"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-comment">-- Yield Cmm for Info Table Provenance Entries (IPEs)</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681893158"><span class="annot"><span class="annottext">denv' :: InfoTableProvMap
</span><a href="#local-6989586621681893158"><span class="hs-identifier hs-var hs-var">denv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681893142"><span class="hs-identifier hs-var">denv</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Types.IPE.html#provInfoTables"><span class="hs-identifier hs-var">provInfoTables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#fromList/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-type">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893160"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893160"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893161"><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681893161"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable -&gt; CLabel
</span><a href="GHC.Cmm.html#cit_lbl"><span class="hs-identifier hs-var">cit_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893160"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681893161"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681893154"><span class="hs-identifier hs-type">labeledInfoTablesWithTickishes</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681893163"><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621681893163"><span class="hs-identifier hs-var">ipeStub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893164"><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681893164"><span class="hs-identifier hs-var">ipeCmmGroup</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; FCodeState
-&gt; CgState
-&gt; FCode (CStub, CmmGroup)
-&gt; ((CStub, CmmGroup), CgState)
forall a.
StgToCmmConfig -&gt; FCodeState -&gt; CgState -&gt; FCode a -&gt; (a, CgState)
</span><a href="GHC.StgToCmm.Monad.html#runC"><span class="hs-identifier hs-var">runC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; StgToCmmConfig
</span><a href="GHC.Driver.Config.StgToCmm.html#initStgToCmmConfig"><span class="hs-identifier hs-var">initStgToCmmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681893144"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681893141"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FCodeState
</span><a href="#local-6989586621681893147"><span class="hs-identifier hs-var">fstate</span></a></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681893150"><span class="hs-identifier hs-var">cgState</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode (CStub, CmmGroup) -&gt; ((CStub, CmmGroup), CgState))
-&gt; FCode (CStub, CmmGroup) -&gt; ((CStub, CmmGroup), CgState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FCode CStub -&gt; FCode (CStub, CmmGroup)
forall a. FCode a -&gt; FCode (a, CmmGroup)
</span><a href="GHC.StgToCmm.Monad.html#getCmm"><span class="hs-identifier hs-var">getCmm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CmmInfoTable] -&gt; InfoTableProvMap -&gt; FCode CStub
</span><a href="GHC.StgToCmm.Prof.html#initInfoTableProv"><span class="hs-identifier hs-var">initInfoTableProv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Label, CmmInfoTable, Maybe IpeSourceLocation) -&gt; CmmInfoTable)
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; [CmmInfoTable]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Label, CmmInfoTable, Maybe IpeSourceLocation) -&gt; CmmInfoTable
forall a b c. (a, b, c) -&gt; b
</span><a href="GHC.Utils.Misc.html#sndOf3"><span class="hs-identifier hs-var">sndOf3</span></a></span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
</span><a href="#local-6989586621681893154"><span class="hs-identifier hs-var">labeledInfoTablesWithTickishes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681893158"><span class="hs-identifier hs-var">denv'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleSRTInfo
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893167"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893167"><span class="hs-identifier hs-var">ipeCmmGroupSRTs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ModuleSRTInfo, CmmGroupSRTs)
-&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, CmmGroupSRTs)
forall a. IO a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.0.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ModuleSRTInfo, CmmGroupSRTs)
 -&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, CmmGroupSRTs))
-&gt; IO (ModuleSRTInfo, CmmGroupSRTs)
-&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, CmmGroupSRTs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; CmmConfig
-&gt; ModuleSRTInfo
-&gt; CmmGroup
-&gt; IO (ModuleSRTInfo, CmmGroupSRTs)
</span><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier hs-var">cmmPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681893146"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">CmmConfig
</span><a href="#local-6989586621681893148"><span class="hs-identifier hs-var">cmm_cfg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSRTInfo
</span><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-var">emptySRT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681893141"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681893164"><span class="hs-identifier hs-var">ipeCmmGroup</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; Stream IO CmmGroupSRTs ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a ()
</span><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-var">Stream.yield</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893167"><span class="hs-identifier hs-var">ipeCmmGroupSRTs</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="annottext">CmmCgInfos -&gt; Stream IO CmmGroupSRTs CmmCgInfos
forall a. a -&gt; Stream IO CmmGroupSRTs a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CmmCgInfos"><span class="hs-identifier hs-type">CmmCgInfos</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">cgNonCafs :: NonCaffySet
</span><a href="GHC.StgToCmm.Types.html#cgNonCafs"><span class="hs-identifier hs-var">cgNonCafs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonCaffySet
</span><a href="#local-6989586621681893155"><span class="hs-identifier hs-var">nonCaffySet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgLFInfos :: ModuleLFInfos
</span><a href="GHC.StgToCmm.Types.html#cgLFInfos"><span class="hs-identifier hs-var">cgLFInfos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681893156"><span class="hs-identifier hs-var">moduleLFInfos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgIPEStub :: CStub
</span><a href="GHC.StgToCmm.Types.html#cgIPEStub"><span class="hs-identifier hs-var">cgIPEStub</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621681893163"><span class="hs-identifier hs-var">ipeStub</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621681893152"><span class="hs-identifier hs-type">collect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621681893152"><span class="annot"><span class="annottext">collect :: Platform
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; CmmGroupSRTs
-&gt; IO
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
</span><a href="#local-6989586621681893152"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span id="local-6989586621681893173"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681893173"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681893174"><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
</span><a href="#local-6989586621681893174"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681893175"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893175"><span class="hs-identifier hs-var">cmmGroupSRTs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681893176"><span class="annot"><span class="annottext">labelsToInfoTables :: [(Label, CmmInfoTable)]
</span><a href="#local-6989586621681893176"><span class="hs-identifier hs-var hs-var">labelsToInfoTables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; [(Label, CmmInfoTable)]
</span><a href="#local-6989586621681893177"><span class="hs-identifier hs-var">collectInfoTables</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893175"><span class="hs-identifier hs-var">cmmGroupSRTs</span></a></span><span>
</span><span id="line-206"></span><span>          </span><span id="local-6989586621681893178"><span class="annot"><span class="annottext">labelsToInfoTablesToTickishes :: [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
</span><a href="#local-6989586621681893178"><span class="hs-identifier hs-var hs-var">labelsToInfoTablesToTickishes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Label, CmmInfoTable)
 -&gt; (Label, CmmInfoTable, Maybe IpeSourceLocation))
-&gt; [(Label, CmmInfoTable)]
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681893179"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893179"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893180"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893180"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893179"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893180"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; CmmGroupSRTs -&gt; Label -&gt; CmmInfoTable -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893181"><span class="hs-identifier hs-var">lookupEstimatedTick</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681893173"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893175"><span class="hs-identifier hs-var">cmmGroupSRTs</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893179"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893180"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable)]
</span><a href="#local-6989586621681893176"><span class="hs-identifier hs-var">labelsToInfoTables</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
-&gt; IO
     ([(Label, CmmInfoTable, Maybe IpeSourceLocation)], CmmGroupSRTs)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
</span><a href="#local-6989586621681893174"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
-&gt; [(Label, CmmInfoTable, Maybe IpeSourceLocation)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable, Maybe IpeSourceLocation)]
</span><a href="#local-6989586621681893178"><span class="hs-identifier hs-var">labelsToInfoTablesToTickishes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893175"><span class="hs-identifier hs-var">cmmGroupSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621681893012"><span class="annot"><a href="#local-6989586621681893153"><span class="hs-identifier hs-type">collectNothing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681893012"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681893012"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621681893153"><span class="annot"><span class="annottext">collectNothing :: forall a. [a] -&gt; CmmGroupSRTs -&gt; IO ([a], CmmGroupSRTs)
</span><a href="#local-6989586621681893153"><span class="hs-identifier hs-var hs-var">collectNothing</span></a></span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681893184"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893184"><span class="hs-identifier hs-var">cmmGroupSRTs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a], CmmGroupSRTs) -&gt; IO ([a], CmmGroupSRTs)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893184"><span class="hs-identifier hs-var">cmmGroupSRTs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="#local-6989586621681893177"><span class="hs-identifier hs-type">collectInfoTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621681893177"><span class="annot"><span class="annottext">collectInfoTables :: CmmGroupSRTs -&gt; [(Label, CmmInfoTable)]
</span><a href="#local-6989586621681893177"><span class="hs-identifier hs-var hs-var">collectInfoTables</span></a></span></span><span> </span><span id="local-6989586621681893185"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893185"><span class="hs-identifier hs-var">cmmGroup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Label, CmmInfoTable)]] -&gt; [(Label, CmmInfoTable)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.0.0/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[(Label, CmmInfoTable)]] -&gt; [(Label, CmmInfoTable)])
-&gt; [[(Label, CmmInfoTable)]] -&gt; [(Label, CmmInfoTable)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
 -&gt; Maybe [(Label, CmmInfoTable)])
-&gt; CmmGroupSRTs -&gt; [[(Label, CmmInfoTable)]]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.0.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; Maybe [(Label, CmmInfoTable)]
</span><a href="#local-6989586621681893187"><span class="hs-identifier hs-var">extractInfoTables</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893185"><span class="hs-identifier hs-var">cmmGroup</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="#local-6989586621681893187"><span class="hs-identifier hs-type">extractInfoTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmTopInfo"><span class="hs-identifier hs-type">CmmTopInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621681893187"><span class="annot"><span class="annottext">extractInfoTables :: GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
-&gt; Maybe [(Label, CmmInfoTable)]
</span><a href="#local-6989586621681893187"><span class="hs-identifier hs-var hs-var">extractInfoTables</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621681893189"><span class="annot"><span class="annottext">CmmTopInfo
</span><a href="#local-6989586621681893189"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Label, CmmInfoTable)] -&gt; Maybe [(Label, CmmInfoTable)]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">([(Label, CmmInfoTable)] -&gt; Maybe [(Label, CmmInfoTable)])
-&gt; [(Label, CmmInfoTable)] -&gt; Maybe [(Label, CmmInfoTable)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap CmmInfoTable -&gt; [(KeyOf LabelMap, CmmInfoTable)]
forall a. LabelMap a -&gt; [(KeyOf LabelMap, a)]
forall (map :: * -&gt; *) a. IsMap map =&gt; map a -&gt; [(KeyOf map, a)]
</span><a href="GHC.Cmm.Dataflow.Collections.html#mapToList"><span class="hs-identifier hs-var">mapToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmTopInfo -&gt; LabelMap CmmInfoTable
</span><a href="GHC.Cmm.html#info_tbls"><span class="hs-identifier hs-var">info_tbls</span></a></span><span> </span><span class="annot"><span class="annottext">CmmTopInfo
</span><a href="#local-6989586621681893189"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="#local-6989586621681893187"><span class="hs-identifier hs-var">extractInfoTables</span></a></span><span> </span><span class="annot"><span class="annottext">GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [(Label, CmmInfoTable)]
forall a. Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><a href="#local-6989586621681893181"><span class="hs-identifier hs-type">lookupEstimatedTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmInfoTable"><span class="hs-identifier hs-type">CmmInfoTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621681893181"><span class="annot"><span class="annottext">lookupEstimatedTick :: Platform
-&gt; CmmGroupSRTs -&gt; Label -&gt; CmmInfoTable -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893181"><span class="hs-identifier hs-var hs-var">lookupEstimatedTick</span></a></span></span><span> </span><span id="local-6989586621681893191"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681893191"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681893192"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893192"><span class="hs-identifier hs-var">cmmGroup</span></a></span></span><span> </span><span id="local-6989586621681893193"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893193"><span class="hs-identifier hs-var">infoTableLabel</span></a></span></span><span> </span><span id="local-6989586621681893194"><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893194"><span class="hs-identifier hs-var">infoTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-comment">-- All return frame info tables are stack represented, though not all stack represented info</span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-comment">-- tables have to be return frames.</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMRep -&gt; Bool
</span><a href="GHC.Runtime.Heap.Layout.html#isStackRep"><span class="hs-identifier hs-var">isStackRep</span></a></span><span> </span><span class="annot"><span class="annottext">(SMRep -&gt; Bool) -&gt; (CmmInfoTable -&gt; SMRep) -&gt; CmmInfoTable -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable -&gt; SMRep
</span><a href="GHC.Cmm.html#cit_rep"><span class="hs-identifier hs-var">cit_rep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893194"><span class="hs-identifier hs-var">infoTable</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681893197"><span class="annot"><span class="annottext">findFun :: Block CmmNode C C -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893197"><span class="hs-identifier hs-var hs-var">findFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformTablesNextToCode"><span class="hs-identifier hs-var">platformTablesNextToCode</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681893191"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-227"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Label -&gt; Block CmmNode C C -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893198"><span class="hs-identifier hs-var">findCmmTickishWithTNTC</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893193"><span class="hs-identifier hs-var">infoTableLabel</span></a></span><span>
</span><span id="line-228"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Block CmmNode C C -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893199"><span class="hs-identifier hs-var">findCmmTickishSansTNTC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmInfoTable -&gt; CLabel
</span><a href="GHC.Cmm.html#cit_lbl"><span class="hs-identifier hs-var">cit_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681893194"><span class="hs-identifier hs-var">infoTable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>              </span><span id="local-6989586621681893200"><span class="annot"><span class="annottext">blocks :: [Block CmmNode C C]
</span><a href="#local-6989586621681893200"><span class="hs-identifier hs-var hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmGraph -&gt; [Block CmmNode C C])
-&gt; [CmmGraph] -&gt; [Block CmmNode C C]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.0.0/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph -&gt; [Block CmmNode C C]
</span><a href="GHC.Cmm.html#toBlockList"><span class="hs-identifier hs-var">toBlockList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; [CmmGraph]
</span><a href="#local-6989586621681893203"><span class="hs-identifier hs-var">graphs</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681893192"><span class="hs-identifier hs-var">cmmGroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="annottext">[Maybe IpeSourceLocation] -&gt; Maybe IpeSourceLocation
forall (f :: * -&gt; *) a. Foldable f =&gt; f (Maybe a) -&gt; Maybe a
</span><a href="GHC.Data.Maybe.html#firstJusts"><span class="hs-identifier hs-var">firstJusts</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe IpeSourceLocation] -&gt; Maybe IpeSourceLocation)
-&gt; [Maybe IpeSourceLocation] -&gt; Maybe IpeSourceLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Block CmmNode C C -&gt; Maybe IpeSourceLocation)
-&gt; [Block CmmNode C C] -&gt; [Maybe IpeSourceLocation]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893197"><span class="hs-identifier hs-var">findFun</span></a></span><span> </span><span class="annot"><span class="annottext">[Block CmmNode C C]
</span><a href="#local-6989586621681893200"><span class="hs-identifier hs-var">blocks</span></a></span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><a href="#local-6989586621681893203"><span class="hs-identifier hs-type">graphs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621681893203"><span class="annot"><span class="annottext">graphs :: CmmGroupSRTs -&gt; [CmmGraph]
</span><a href="#local-6989586621681893203"><span class="hs-identifier hs-var hs-var">graphs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([CmmGraph]
 -&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph -&gt; [CmmGraph])
-&gt; [CmmGraph] -&gt; CmmGroupSRTs -&gt; [CmmGraph]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.0.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmGraph]
-&gt; GenCmmDecl RawCmmStatics CmmTopInfo CmmGraph -&gt; [CmmGraph]
forall d h. [CmmGraph] -&gt; GenCmmDecl d h CmmGraph -&gt; [CmmGraph]
</span><a href="#local-6989586621681893205"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>        </span><span id="local-6989586621681893072"><span id="local-6989586621681893073"><span class="annot"><a href="#local-6989586621681893205"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681893072"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681893073"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.html#CmmGraph"><span class="hs-identifier hs-type">CmmGraph</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621681893205"><span class="annot"><span class="annottext">go :: forall d h. [CmmGraph] -&gt; GenCmmDecl d h CmmGraph -&gt; [CmmGraph]
</span><a href="#local-6989586621681893205"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681893206"><span class="annot"><span class="annottext">[CmmGraph]
</span><a href="#local-6989586621681893206"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681893207"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621681893207"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621681893207"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph -&gt; [CmmGraph] -&gt; [CmmGraph]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CmmGraph]
</span><a href="#local-6989586621681893206"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><a href="#local-6989586621681893205"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681893208"><span class="annot"><span class="annottext">[CmmGraph]
</span><a href="#local-6989586621681893208"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenCmmDecl d h CmmGraph
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CmmGraph]
</span><a href="#local-6989586621681893208"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="#local-6989586621681893198"><span class="hs-identifier hs-type">findCmmTickishWithTNTC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621681893198"><span class="annot"><span class="annottext">findCmmTickishWithTNTC :: Label -&gt; Block CmmNode C C -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893198"><span class="hs-identifier hs-var hs-var">findCmmTickishWithTNTC</span></a></span></span><span> </span><span id="local-6989586621681893209"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893209"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621681893210"><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621681893210"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893211"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681893211"><span class="hs-identifier hs-var">middleBlock</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893212"><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621681893212"><span class="hs-identifier hs-var">endBlock</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C -&gt; (CmmNode C O, Block CmmNode O O, CmmNode O C)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n C C -&gt; (n C O, Block n O O, n O C)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621681893210"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">CmmNode O C -&gt; Label -&gt; Maybe ()
</span><a href="#local-6989586621681893213"><span class="hs-identifier hs-var">isCallWithReturnFrameLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><a href="#local-6989586621681893212"><span class="hs-identifier hs-var">endBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893209"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893214"><span class="hs-identifier hs-var">lastTickInBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681893211"><span class="hs-identifier hs-var">middleBlock</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-246"></span><span>        </span><span class="annot"><a href="#local-6989586621681893213"><span class="hs-identifier hs-type">isCallWithReturnFrameLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Label.html#Label"><span class="hs-identifier hs-type">Label</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621681893213"><span class="annot"><span class="annottext">isCallWithReturnFrameLabel :: CmmNode O C -&gt; Label -&gt; Maybe ()
</span><a href="#local-6989586621681893213"><span class="hs-identifier hs-var hs-var">isCallWithReturnFrameLabel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681893220"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893220"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681893221"><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893221"><span class="hs-identifier hs-var">clabel</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893220"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Label -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Label
</span><a href="#local-6989586621681893221"><span class="hs-identifier hs-var">clabel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Maybe ()
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><a href="#local-6989586621681893213"><span class="hs-identifier hs-var">isCallWithReturnFrameLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Label
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ()
forall a. Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621681893214"><span class="annot"><span class="annottext">lastTickInBlock :: Block CmmNode O O -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893214"><span class="hs-identifier hs-var hs-var">lastTickInBlock</span></a></span></span><span> </span><span id="local-6989586621681893222"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681893222"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>          </span><span class="annot"><span class="annottext">[IpeSourceLocation] -&gt; Maybe IpeSourceLocation
forall a. [a] -&gt; Maybe a
</span><a href="../../base-4.18.0.0/src/Data.Maybe.html#listToMaybe/Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([IpeSourceLocation] -&gt; Maybe IpeSourceLocation)
-&gt; [IpeSourceLocation] -&gt; Maybe IpeSourceLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-252"></span><span>              </span><span class="annot"><span class="annottext">(CmmNode O O -&gt; Maybe IpeSourceLocation)
-&gt; [CmmNode O O] -&gt; [IpeSourceLocation]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.0.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O O -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893223"><span class="hs-identifier hs-var">maybeTick</span></a></span><span> </span><span class="annot"><span class="annottext">([CmmNode O O] -&gt; [IpeSourceLocation])
-&gt; [CmmNode O O] -&gt; [IpeSourceLocation]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CmmNode O O] -&gt; [CmmNode O O]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.0.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([CmmNode O O] -&gt; [CmmNode O O])
-&gt; (Block CmmNode O O -&gt; [CmmNode O O])
-&gt; Block CmmNode O O
-&gt; [CmmNode O O]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681893222"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><a href="#local-6989586621681893223"><span class="hs-identifier hs-type">maybeTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span id="local-6989586621681893223"><span class="annot"><span class="annottext">maybeTick :: CmmNode O O -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893223"><span class="hs-identifier hs-var hs-var">maybeTick</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-type">SourceNote</span></a></span><span> </span><span id="local-6989586621681893228"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681893228"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621681893229"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681893229"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation -&gt; Maybe IpeSourceLocation
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681893228"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681893229"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><a href="#local-6989586621681893223"><span class="hs-identifier hs-var">maybeTick</span></a></span><span> </span><span class="annot"><span class="annottext">CmmNode O O
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><a href="#local-6989586621681893199"><span class="hs-identifier hs-type">findCmmTickishSansTNTC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621681893199"><span class="annot"><span class="annottext">findCmmTickishSansTNTC :: CLabel -&gt; Block CmmNode C C -&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893199"><span class="hs-identifier hs-var hs-var">findCmmTickishSansTNTC</span></a></span></span><span> </span><span id="local-6989586621681893230"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893230"><span class="hs-identifier hs-var">cLabel</span></a></span></span><span> </span><span id="local-6989586621681893231"><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621681893231"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmNode C O
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681893232"><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681893232"><span class="hs-identifier hs-var">middleBlock</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmNode O C
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C -&gt; (CmmNode C O, Block CmmNode O O, CmmNode O C)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n C C -&gt; (n C O, Block n O O, n O C)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode C C
</span><a href="#local-6989586621681893231"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">CLabel
-&gt; [CmmNode O O]
-&gt; Maybe IpeSourceLocation
-&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893233"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893230"><span class="hs-identifier hs-var">cLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block CmmNode O O -&gt; [CmmNode O O]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n O O -&gt; [n O O]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode O O
</span><a href="#local-6989586621681893232"><span class="hs-identifier hs-var">middleBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><a href="#local-6989586621681893233"><span class="hs-identifier hs-type">find</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#O"><span class="hs-identifier hs-type">O</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#IpeSourceLocation"><span class="hs-identifier hs-type">IpeSourceLocation</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span id="local-6989586621681893233"><span class="annot"><span class="annottext">find :: CLabel
-&gt; [CmmNode O O]
-&gt; Maybe IpeSourceLocation
-&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893233"><span class="hs-identifier hs-var hs-var">find</span></a></span></span><span> </span><span id="local-6989586621681893234"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893234"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681893235"><span class="annot"><span class="annottext">CmmNode O O
</span><a href="#local-6989586621681893235"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681893236"><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621681893236"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681893237"><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681893237"><span class="hs-identifier hs-var">lastTick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmNode O O
</span><a href="#local-6989586621681893235"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-265"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621681893245"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893245"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893234"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CLabel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893245"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681893237"><span class="hs-identifier hs-var">lastTick</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CLabel
-&gt; [CmmNode O O]
-&gt; Maybe IpeSourceLocation
-&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893233"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893234"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621681893236"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681893237"><span class="hs-identifier hs-var">lastTick</span></a></span><span>
</span><span id="line-266"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmTick"><span class="hs-identifier hs-type">CmmTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-type">SourceNote</span></a></span><span> </span><span id="local-6989586621681893248"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681893248"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621681893249"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681893249"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CLabel
-&gt; [CmmNode O O]
-&gt; Maybe IpeSourceLocation
-&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893233"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893234"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621681893236"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe IpeSourceLocation -&gt; Maybe IpeSourceLocation)
-&gt; Maybe IpeSourceLocation -&gt; Maybe IpeSourceLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.0.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IpeSourceLocation -&gt; Maybe IpeSourceLocation
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681893248"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681893249"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>          </span><span class="annot"><span class="annottext">CmmNode O O
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CLabel
-&gt; [CmmNode O O]
-&gt; Maybe IpeSourceLocation
-&gt; Maybe IpeSourceLocation
</span><a href="#local-6989586621681893233"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681893234"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode O O]
</span><a href="#local-6989586621681893236"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681893237"><span class="hs-identifier hs-var">lastTick</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><a href="#local-6989586621681893233"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IpeSourceLocation
forall a. Maybe a
</span><a href="../../base-4.18.0.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-269"></span></pre></body></html>